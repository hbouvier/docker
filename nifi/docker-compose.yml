version: '3.6'
services:

  nifi:
    image: registry.gitlab.com/pod-o-mat/docker/nifi:1.9.0
    restart: always
    hostname: nifi
    container_name: nifi
    user: root
    command: chown -R 1000:1000 /opt/nifi/nifi-current/database_repository && \
             chown -R 1000:1000 /opt/nifi/nifi-current/flowfile_repository && \
             chown -R 1000:1000 /opt/nifi/nifi-current/content_repository && \
             chown -R 1000:1000 /opt/nifi/nifi-current/provenance_repository && \
             chown -R 1000:1000 /opt/nifi/nifi-current/conf && \
             ../scripts/start.sh
    environment:
    - NIFI_WEB_HTTP_HOST=0.0.0.0
    - NIFI_WEB_HTTP_PORT=9090

    ports:
    - 9090:9090

    volumes: 
    - nifi_database:/opt/nifi/nifi-current/database_repository
    - nifi_flowfile:/opt/nifi/nifi-current/flowfile_repository
    - nifi_content:/opt/nifi/nifi-current/content_repository
    - nifi_provenance:/opt/nifi/nifi-current/provenance_repository
    - nifi_conf:/opt/nifi/nifi-current/conf

    networks:
    - hadoop

networks:
  hadoop:
    external: true

volumes:
  nifi_database: {}
  nifi_flowfile: {}
  nifi_content: {}
  nifi_provenance: {}
  nifi_conf: {}
